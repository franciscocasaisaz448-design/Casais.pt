local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local UI_TOGGLE_KEY = Enum.KeyCode.M
local panelVisible = false
local prevMouseBehavior, prevMouseIconEnabled
local spectating, savedSubject, savedCamType
local selectedPlayer
local playerButtons = {}

local function getPrimaryPart(char)
	if not char then return nil end
	return char.PrimaryPart or char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso")
end

local FlySystem = {
    flying = false,
    noclip = false,
    speed = 50,
    bodyGyro = nil,
    bodyVelocity = nil,
    control = {F = 0, B = 0, L = 0, R = 0, U = 0, D = 0}
}

function FlySystem:toggleFly()
    self.flying = not self.flying
    local character = LocalPlayer.Character
    if not character then return end
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end

    if self.flying then
        self.bodyGyro = Instance.new("BodyGyro", humanoidRootPart)
        self.bodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)
        self.bodyGyro.D = 1000
        self.bodyGyro.CFrame = humanoidRootPart.CFrame
        self.bodyVelocity = Instance.new("BodyVelocity", humanoidRootPart)
        self.bodyVelocity.MaxForce = Vector3.new(400000, 400000, 400000)
        self.bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    else
        if self.bodyGyro then self.bodyGyro:Destroy() end
        if self.bodyVelocity then self.bodyVelocity:Destroy() end
        self.bodyGyro = nil
        self.bodyVelocity = nil
    end
end

function FlySystem:disableFly()
    if self.flying then
        self.flying = false
        if self.bodyGyro then self.bodyGyro:Destroy() end
        if self.bodyVelocity then self.bodyVelocity:Destroy() end
        self.bodyGyro = nil
        self.bodyVelocity = nil
    end
end

function FlySystem:toggleNoclip()
    self.noclip = not self.noclip
end

function FlySystem:setupControls()
    UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == Enum.KeyCode.W then self.control.F = 1 end
        if input.KeyCode == Enum.KeyCode.S then self.control.B = 1 end
        if input.KeyCode == Enum.KeyCode.A then self.control.L = 1 end
        if input.KeyCode == Enum.KeyCode.D then self.control.R = 1 end
        if input.KeyCode == Enum.KeyCode.Space then self.control.U = 1 end
        if input.KeyCode == Enum.KeyCode.LeftControl then self.control.D = 1 end
    end)
    UserInputService.InputEnded:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == Enum.KeyCode.W then self.control.F = 0 end
        if input.KeyCode == Enum.KeyCode.S then self.control.B = 0 end
        if input.KeyCode == Enum.KeyCode.A then self.control.L = 0 end
        if input.KeyCode == Enum.KeyCode.D then self.control.R = 0 end
        if input.KeyCode == Enum.KeyCode.Space then self.control.U = 0 end
        if input.KeyCode == Enum.KeyCode.LeftControl then self.control.D = 0 end
    end)
end

function FlySystem:startLoop()
    RunService.RenderStepped:Connect(function()
        local character = LocalPlayer.Character
        if not character then return end
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end

        if self.noclip then
            for _, v in pairs(character:GetDescendants()) do
                if v:IsA("BasePart") and v.CanCollide == true then
                    v.CanCollide = false
                end
            end
        end

        if self.flying and humanoidRootPart then
            local cam = workspace.CurrentCamera
            local moveVec = Vector3.zero
            local forward = cam.CFrame.LookVector
            local right = cam.CFrame.RightVector
            local up = Vector3.new(0, 1, 0)
            moveVec = moveVec + forward * (self.control.F - self.control.B) + right * (self.control.R - self.control.L) + up * (self.control.U - self.control.D)
            if moveVec.Magnitude > 0 then
                moveVec = moveVec.Unit * self.speed
                humanoidRootPart.CFrame = humanoidRootPart.CFrame + moveVec
            end
        end
    end)
end

function FlySystem:init()
    self:setupControls()
    self:startLoop()
end

local function startSpectate(p)
    if not p or p == LocalPlayer then return end
    local targetChar = p.Character
    if not targetChar then return end
    local hum = targetChar:FindFirstChildOfClass("Humanoid")
    if not hum then return end
    if not savedSubject then savedSubject = Camera.CameraSubject end
    if not savedCamType then savedCamType = Camera.CameraType end
    Camera.CameraType = Enum.CameraType.Custom
    Camera.CameraSubject = hum
    spectating = p
end

local function stopSpectate()
    if savedSubject then Camera.CameraSubject = savedSubject end
    if savedCamType then Camera.CameraType = savedCamType end
    spectating = nil
end

local function instantTPTo(targetPlayer)
	if not targetPlayer or targetPlayer == LocalPlayer then return end
	local char = LocalPlayer.Character
	local targetChar = targetPlayer.Character
	if not char or not targetChar then return end
	local srcPart = getPrimaryPart(char)
	local dstPart = getPrimaryPart(targetChar)
	if not srcPart or not dstPart then return end
	char:PivotTo(CFrame.new(dstPart.Position + Vector3.new(0,3,0)))
end

local gui = Instance.new("ScreenGui")
gui.Name = "AdminPanel"
gui.ResetOnSpawn = false
gui.Parent = game.CoreGui

local frame = Instance.new("Frame")
frame.Size = UDim2.fromOffset(900, 620)
frame.Position = UDim2.new(0.5, -450, 0.5, -310)
frame.BackgroundColor3 = Color3.fromRGB(18,18,26)
frame.Active = true
frame.Draggable = true
frame.Visible = false
frame.Parent = gui
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 18)

local frameStroke = Instance.new("UIStroke")
frameStroke.Color = Color3.fromRGB(139, 92, 246)
frameStroke.Thickness = 2
frameStroke.Transparency = 0.5
frameStroke.Parent = frame

local shadow = Instance.new("ImageLabel")
shadow.Size = UDim2.new(1, 30, 1, 30)
shadow.Position = UDim2.new(0, -15, 0, -15)
shadow.BackgroundTransparency = 1
shadow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
shadow.ImageColor3 = Color3.fromRGB(0,0,0)
shadow.ImageTransparency = 0.7
shadow.ZIndex = 0
shadow.Parent = frame

local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0, 75)
header.BackgroundColor3 = Color3.fromRGB(139, 92, 246)
header.BorderSizePixel = 0
header.Parent = frame
local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 18)
headerCorner.Parent = header
local headerCover = Instance.new("Frame")
headerCover.Size = UDim2.new(1, 0, 0, 30)
headerCover.Position = UDim2.new(0, 0, 1, -30)
headerCover.BackgroundColor3 = Color3.fromRGB(139, 92, 246)
headerCover.BorderSizePixel = 0
headerCover.Parent = header

local titleIcon = Instance.new("TextLabel")
titleIcon.Size = UDim2.new(0, 50, 0, 50)
titleIcon.Position = UDim2.new(0, 15, 0, 10)
titleIcon.BackgroundColor3 = Color3.fromRGB(255,255,255)
titleIcon.BackgroundTransparency = 0.85
titleIcon.Text = "âš¡"
titleIcon.Font = Enum.Font.GothamBold
titleIcon.TextSize = 28
titleIcon.TextColor3 = Color3.fromRGB(255,255,255)
titleIcon.Parent = header
Instance.new("UICorner", titleIcon).CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel")
title.BackgroundTransparency = 1
title.Size = UDim2.new(1, -120, 1, 0)
title.Position = UDim2.new(0, 75, 0, 0)
title.Font = Enum.Font.GothamBold
title.TextSize = 24
title.TextColor3 = Color3.new(1,1,1)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Text = "CASAIS SCRIPTER"
title.Parent = header

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.fromOffset(45, 45)
closeBtn.Position = UDim2.new(1, -60, 0, 12)
closeBtn.Text = "âœ•"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 20
closeBtn.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
closeBtn.Parent = header
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 10)

local tabs = Instance.new("ScrollingFrame")
tabs.Size = UDim2.new(0, 150, 1, -95)
tabs.Position = UDim2.new(0, 15, 0, 85)
tabs.BackgroundTransparency = 1
tabs.BorderSizePixel = 0
tabs.ScrollBarThickness = 4
tabs.CanvasSize = UDim2.new(0,0,0,0)
tabs.AutomaticCanvasSize = Enum.AutomaticSize.Y
tabs.Parent = frame
local tabsLayout = Instance.new("UIListLayout", tabs)
tabsLayout.Padding = UDim.new(0,8)
tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder

local function makeTab(text, order)
	local b = Instance.new("TextButton")
	b.Size = UDim2.new(1, -8, 0, 50)
	b.Text = text
	b.Font = Enum.Font.GothamBold
	b.TextSize = 14
	b.BackgroundColor3 = Color3.fromRGB(30,30,40)
	b.TextColor3 = Color3.fromRGB(180,180,190)
	b.LayoutOrder = order
	b.Parent = tabs
	local corner = Instance.new("UICorner", b)
	corner.CornerRadius = UDim.new(0, 12)
	local stroke = Instance.new("UIStroke", b)
	stroke.Color = Color3.fromRGB(50,50,60)
	stroke.Thickness = 1
	stroke.Transparency = 0.5
	return b
end

local tabPlayers = makeTab("ðŸ‘¥ JOGADORES", 1)
local tabMovement = makeTab("ðŸš€ MOVIMENTO", 2)
local tabAimbot = makeTab("ðŸŽ¯ AIMBOT", 3)
local tabClicker = makeTab("ðŸ–±ï¸ CLICKER", 4)
local tabVision = makeTab("ðŸ‘ï¸ VISÃƒO", 5)
local tabPerformance = makeTab("âš¡ DESEMPENHO", 6)
local tabMisc = makeTab("âš™ï¸ MISC", 7)

local pages = Instance.new("Frame")
pages.Size = UDim2.new(1, -185, 1, -95)
pages.Position = UDim2.new(0, 175, 0, 85)
pages.BackgroundTransparency = 1
pages.Parent = frame

local function makePage()
	local p=Instance.new("ScrollingFrame")
	p.Size=UDim2.fromScale(1,1)
	p.BackgroundTransparency=1
	p.BorderSizePixel=0
	p.ScrollBarThickness=6
	p.CanvasSize=UDim2.new(0,0,0,0)
	p.AutomaticCanvasSize=Enum.AutomaticSize.Y
	p.Visible=false
	p.Parent=pages
	local layout=Instance.new("UIListLayout",p)
	layout.Padding=UDim.new(0,10)
	layout.SortOrder=Enum.SortOrder.LayoutOrder
	return p
end

local playersPage = makePage(); playersPage.Visible = true
local movementPage = makePage()
local aimbotPage = makePage()
local clickerPage = makePage()
local visionPage = makePage()
local performancePage = makePage()
local miscPage = makePage()

local aimbotEnabled = false
local aimbotFOV = 80
local aimbotTarget = "Head"
local aimbotKey = Enum.UserInputType.MouseButton2
local aimbotKeyName = "BotÃ£o Direito"
local aimbotSmooth = 5
local fovCircle = nil
local waitingForKey = false

local autoClickerEnabled = false
local autoClickerSpeed = 50
local autoClickerKey = Enum.KeyCode.C
local autoClickerKeyName = "C"
local waitingForClickerKey = false
local lastClickTime = 0

local function getClosestPlayer()
	local closestPlayer = nil
	local shortestDistance = aimbotFOV
	local mousePos = UserInputService:GetMouseLocation()
	
	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character then
			local char = player.Character
			local hum = char:FindFirstChildOfClass("Humanoid")
			if hum and hum.Health > 0 then
				local targetPart = char:FindFirstChild(aimbotTarget)
				if targetPart then
					local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
					if onScreen and screenPos.Z > 0 then
						local distance = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
						if distance < shortestDistance then
							shortestDistance = distance
							closestPlayer = player
						end
					end
				end
			end
		end
	end
	
	return closestPlayer
end

RunService.RenderStepped:Connect(function()
	pcall(function()
		if aimbotEnabled then
			if not fovCircle then
				fovCircle = Drawing.new("Circle")
				fovCircle.Thickness = 2
				fovCircle.NumSides = 50
				fovCircle.Filled = false
				fovCircle.Transparency = 1
				fovCircle.Color = Color3.fromRGB(255, 70, 70)
			end
			
			if fovCircle then
				local mousePos = UserInputService:GetMouseLocation()
				fovCircle.Position = mousePos
				fovCircle.Radius = aimbotFOV
				fovCircle.Visible = true
			end
			
			local isKeyPressed = false
			if aimbotKey == Enum.UserInputType.MouseButton2 then
				isKeyPressed = UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2)
			elseif aimbotKey == Enum.UserInputType.MouseButton1 then
				isKeyPressed = UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1)
			else
				isKeyPressed = UserInputService:IsKeyDown(aimbotKey)
			end
			
			if isKeyPressed then
				local target = getClosestPlayer()
				if target and target.Character then
					local targetPart = target.Character:FindFirstChild(aimbotTarget)
					if targetPart then
						local targetPos = targetPart.Position
						local currentCFrame = Camera.CFrame
						local targetCFrame = CFrame.new(currentCFrame.Position, targetPos)
						local smoothValue = math.max(aimbotSmooth, 1)
						Camera.CFrame = currentCFrame:Lerp(targetCFrame, 1 / smoothValue)
					end
				end
			end
		else
			if fovCircle then 
				fovCircle.Visible = false 
			end
		end
	end)
end)

RunService.Heartbeat:Connect(function()
	if autoClickerEnabled then
		local currentTime = tick()
		if currentTime - lastClickTime >= autoClickerSpeed / 1000 then
			mouse1click()
			lastClickTime = currentTime
		end
	end
end)

local function updatePlayersList()
	for _, child in ipairs(playersPage:GetChildren()) do
		if child:IsA("TextButton") then child:Destroy() end
	end
	playerButtons = {}
	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer then
			-- Criar botÃ£o do jogador aqui
		end
	end
end

local function setTab(which)
	tabPlayers.BackgroundColor3 = Color3.fromRGB(30,30,40)
	tabPlayers.TextColor3 = Color3.fromRGB(180,180,190)
	tabMovement.BackgroundColor3 = Color3.fromRGB(30,30,40)
	tabMovement.TextColor3 = Color3.fromRGB(180,180,190)
	tabAimbot.BackgroundColor3 = Color3.fromRGB(30,30,40)
	tabAimbot.TextColor3 = Color3.fromRGB(180,180,190)
	tabClicker.BackgroundColor3 = Color3.fromRGB(30,30,40)
	tabClicker.TextColor3 = Color3.fromRGB(180,180,190)
	tabVision.BackgroundColor3 = Color3.fromRGB(30,30,40)
	tabVision.TextColor3 = Color3.fromRGB(180,180,190)
	tabPerformance.BackgroundColor3 = Color3.fromRGB(30,30,40)
	tabPerformance.TextColor3 = Color3.fromRGB(180,180,190)
	tabMisc.BackgroundColor3 = Color3.fromRGB(30,30,40)
	tabMisc.TextColor3 = Color3.fromRGB(180,180,190)
	playersPage.Visible=false; movementPage.Visible=false; aimbotPage.Visible=false; clickerPage.Visible=false; visionPage.Visible=false; performancePage.Visible=false; miscPage.Visible=false
	if which=="PLAYERS" then 
		tabPlayers.BackgroundColor3=Color3.fromRGB(139, 92, 246)
		tabPlayers.TextColor3=Color3.fromRGB(255,255,255)
		playersPage.Visible=true
	elseif which=="MOVEMENT" then 
		tabMovement.BackgroundColor3=Color3.fromRGB(139, 92, 246)
		tabMovement.TextColor3=Color3.fromRGB(255,255,255)
		movementPage.Visible=true
	elseif which=="AIMBOT" then 
		tabAimbot.BackgroundColor3=Color3.fromRGB(139, 92, 246)
		tabAimbot.TextColor3=Color3.fromRGB(255,255,255)
		aimbotPage.Visible=true
	elseif which=="CLICKER" then 
		tabClicker.BackgroundColor3=Color3.fromRGB(139, 92, 246)
		tabClicker.TextColor3=Color3.fromRGB(255,255,255)
		clickerPage.Visible=true
	elseif which=="VISION" then 
		tabVision.BackgroundColor3=Color3.fromRGB(139, 92, 246)
		tabVision.TextColor3=Color3.fromRGB(255,255,255)
		visionPage.Visible=true
	elseif which=="PERFORMANCE" then 
		tabPerformance.BackgroundColor3=Color3.fromRGB(139, 92, 246)
		tabPerformance.TextColor3=Color3.fromRGB(255,255,255)
		performancePage.Visible=true
	else 
		tabMisc.BackgroundColor3=Color3.fromRGB(139, 92, 246)
		tabMisc.TextColor3=Color3.fromRGB(255,255,255)
		miscPage.Visible=true 
	end
end

tabPlayers.MouseButton1Click:Connect(function() setTab("PLAYERS") end)
tabMovement.MouseButton1Click:Connect(function() setTab("MOVEMENT") end)
tabAimbot.MouseButton1Click:Connect(function() setTab("AIMBOT") end)
tabClicker.MouseButton1Click:Connect(function() setTab("CLICKER") end)
tabVision.MouseButton1Click:Connect(function() setTab("VISION") end)
tabPerformance.MouseButton1Click:Connect(function() setTab("PERFORMANCE") end)
tabMisc.MouseButton1Click:Connect(function() setTab("MISC") end)

closeBtn.MouseButton1Click:Connect(function() 
	frame.Visible = false
	panelVisible = false
	if prevMouseBehavior then UserInputService.MouseBehavior = prevMouseBehavior end
	if prevMouseIconEnabled ~= nil then UserInputService.MouseIconEnabled = prevMouseIconEnabled end
end)

local function showPanel(show)
	if panelVisible == show then return end
	panelVisible = show
	frame.Visible = show
	if show then
		prevMouseBehavior = UserInputService.MouseBehavior
		prevMouseIconEnabled = UserInputService.MouseIconEnabled
		UserInputService.MouseBehavior = Enum.MouseBehavior.Default
		UserInputService.MouseIconEnabled = true
		updatePlayersList()
	else
		if prevMouseBehavior then UserInputService.MouseBehavior = prevMouseBehavior end
		if prevMouseIconEnabled ~= nil then UserInputService.MouseIconEnabled = prevMouseIconEnabled end
	end
end

UserInputService.InputBegan:Connect(function(input, processed)
	if processed then return end
	if input.KeyCode == Enum.KeyCode.M then 
		showPanel(not panelVisible)
	elseif input.KeyCode == autoClickerKey then
		autoClickerEnabled = not autoClickerEnabled
	elseif input.KeyCode == Enum.KeyCode.F then
		FlySystem:toggleFly()
	elseif input.KeyCode == Enum.KeyCode.P then
		UserInputService.MouseBehavior = Enum.MouseBehavior.Default
		UserInputService.MouseIconEnabled = true
	end
end)

Players.PlayerAdded:Connect(function(p) task.wait(0.5); updatePlayersList() end)
Players.PlayerRemoving:Connect(function(p)
	if playerButtons[p] then playerButtons[p]:Destroy(); playerButtons[p] = nil end
	if selectedPlayer == p then selectedPlayer = nil end
	if spectating == p then stopSpectate() end
end)

LocalPlayer.CharacterAdded:Connect(function(char)
	local hum = char:WaitForChild("Humanoid")
	hum.Died:Connect(function()
		FlySystem:disableFly()
	end)
end)

FlySystem:init()
updatePlayersList()
setTab("PLAYERS")
print("âœ… Admin Panel PRO carregado!")
print("ðŸ”‘ Pressione M para abrir o menu")
print("ðŸŽ¯ Tecla Aimbot: " .. aimbotKeyName)
