local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local panelVisible = false
local prevMouseBehavior, prevMouseIconEnabled
local spectating, savedSubject, savedCamType
local selectedPlayer
local playerButtons = {}

local function getPrimaryPart(char)
	if not char then return nil end
	return char.PrimaryPart or char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso")
end

local FlySystem = {
    flying = false,
    noclip = false,
    speed = 50,
    bodyGyro = nil,
    bodyVelocity = nil,
    control = {F = 0, B = 0, L = 0, R = 0, U = 0, D = 0}
}

function FlySystem:toggleFly()
    self.flying = not self.flying
    local character = LocalPlayer.Character
    if not character then return end
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end

    if self.flying then
        self.bodyGyro = Instance.new("BodyGyro", humanoidRootPart)
        self.bodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)
        self.bodyGyro.D = 1000
        self.bodyGyro.CFrame = humanoidRootPart.CFrame
        self.bodyVelocity = Instance.new("BodyVelocity", humanoidRootPart)
        self.bodyVelocity.MaxForce = Vector3.new(400000, 400000, 400000)
        self.bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    else
        if self.bodyGyro then self.bodyGyro:Destroy() end
        if self.bodyVelocity then self.bodyVelocity:Destroy() end
        self.bodyGyro = nil
        self.bodyVelocity = nil
    end
end

function FlySystem:disableFly()
    if self.flying then
        self.flying = false
        if self.bodyGyro then self.bodyGyro:Destroy() end
        if self.bodyVelocity then self.bodyVelocity:Destroy() end
        self.bodyGyro = nil
        self.bodyVelocity = nil
    end
end

function FlySystem:toggleNoclip()
    self.noclip = not self.noclip
end

function FlySystem:setupControls()
    UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == Enum.KeyCode.W then self.control.F = 1 end
        if input.KeyCode == Enum.KeyCode.S then self.control.B = 1 end
        if input.KeyCode == Enum.KeyCode.A then self.control.L = 1 end
        if input.KeyCode == Enum.KeyCode.D then self.control.R = 1 end
        if input.KeyCode == Enum.KeyCode.Space then self.control.U = 1 end
        if input.KeyCode == Enum.KeyCode.LeftControl then self.control.D = 1 end
    end)
    UserInputService.InputEnded:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == Enum.KeyCode.W then self.control.F = 0 end
        if input.KeyCode == Enum.KeyCode.S then self.control.B = 0 end
        if input.KeyCode == Enum.KeyCode.A then self.control.L = 0 end
        if input.KeyCode == Enum.KeyCode.D then self.control.R = 0 end
        if input.KeyCode == Enum.KeyCode.Space then self.control.U = 0 end
        if input.KeyCode == Enum.KeyCode.LeftControl then self.control.D = 0 end
    end)
end

function FlySystem:startLoop()
    RunService.RenderStepped:Connect(function()
        local character = LocalPlayer.Character
        if not character then return end
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end

        if self.noclip then
            for _, v in pairs(character:GetDescendants()) do
                if v:IsA("BasePart") and v.CanCollide == true then
                    v.CanCollide = false
                end
            end
        end

        if self.flying and humanoidRootPart then
            local cam = workspace.CurrentCamera
            local moveVec = Vector3.zero
            local forward = cam.CFrame.LookVector
            local right = cam.CFrame.RightVector
            local up = Vector3.new(0, 1, 0)
            moveVec = moveVec + forward * (self.control.F - self.control.B) + right * (self.control.R - self.control.L) + up * (self.control.U - self.control.D)
            if moveVec.Magnitude > 0 then
                moveVec = moveVec.Unit * self.speed
                humanoidRootPart.CFrame = humanoidRootPart.CFrame + moveVec
            end
        end
    end)
end

function FlySystem:init()
    self:setupControls()
    self:startLoop()
end

local function startSpectate(p)
    if not p or p == LocalPlayer then return end
    local targetChar = p.Character
    if not targetChar then return end
    local hum = targetChar:FindFirstChildOfClass("Humanoid")
    if not hum then return end
    if not savedSubject then savedSubject = Camera.CameraSubject end
    if not savedCamType then savedCamType = Camera.CameraType end
    Camera.CameraType = Enum.CameraType.Custom
    Camera.CameraSubject = hum
    spectating = p
end

local function stopSpectate()
    if savedSubject then Camera.CameraSubject = savedSubject end
    if savedCamType then Camera.CameraType = savedCamType end
    spectating = nil
end

local function instantTPTo(targetPlayer)
	if not targetPlayer or targetPlayer == LocalPlayer then return end
	local char = LocalPlayer.Character
	local targetChar = targetPlayer.Character
	if not char or not targetChar then return end
	local srcPart = getPrimaryPart(char)
	local dstPart = getPrimaryPart(targetChar)
	if not srcPart or not dstPart then return end
	char:PivotTo(CFrame.new(dstPart.Position + Vector3.new(0,3,0)))
end

-- Criar GUI
local gui = Instance.new("ScreenGui")
gui.Name = "AdminPanel"
gui.ResetOnSpawn = false
gui.Parent = game.CoreGui

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromOffset(900, 620)
frame.Position = UDim2.new(0.5, -450, 0.5, -310)
frame.BackgroundColor3 = Color3.fromRGB(18,18,26)
frame.Active = true
frame.Draggable = true
frame.Visible = false
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 18)

local frameStroke = Instance.new("UIStroke", frame)
frameStroke.Color = Color3.fromRGB(139, 92, 246)
frameStroke.Thickness = 2
frameStroke.Transparency = 0.5

-- Header
local header = Instance.new("Frame", frame)
header.Size = UDim2.new(1, 0, 0, 75)
header.BackgroundColor3 = Color3.fromRGB(139, 92, 246)
header.BorderSizePixel = 0
Instance.new("UICorner", header).CornerRadius = UDim.new(0, 18)

local headerCover = Instance.new("Frame", header)
headerCover.Size = UDim2.new(1, 0, 0, 30)
headerCover.Position = UDim2.new(0, 0, 1, -30)
headerCover.BackgroundColor3 = Color3.fromRGB(139, 92, 246)
headerCover.BorderSizePixel = 0

local title = Instance.new("TextLabel", header)
title.BackgroundTransparency = 1
title.Size = UDim2.new(1, -120, 1, 0)
title.Position = UDim2.new(0, 75, 0, 0)
title.Font = Enum.Font.GothamBold
title.TextSize = 24
title.TextColor3 = Color3.new(1,1,1)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Text = "CASAIS SCRIPTER"

local closeBtn = Instance.new("TextButton", header)
closeBtn.Size = UDim2.fromOffset(45, 45)
closeBtn.Position = UDim2.new(1, -60, 0, 12)
closeBtn.Text = "‚úï"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 20
closeBtn.BackgroundColor3 = Color3.fromRGB(239, 68, 68)
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 10)

-- Tabs
local tabs = Instance.new("ScrollingFrame", frame)
tabs.Size = UDim2.new(0, 150, 1, -95)
tabs.Position = UDim2.new(0, 15, 0, 85)
tabs.BackgroundTransparency = 1
tabs.BorderSizePixel = 0
tabs.ScrollBarThickness = 4
tabs.CanvasSize = UDim2.new(0,0,0,0)
tabs.AutomaticCanvasSize = Enum.AutomaticSize.Y

local tabsLayout = Instance.new("UIListLayout", tabs)
tabsLayout.Padding = UDim.new(0,8)
tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder

local function makeTab(text, order)
	local b = Instance.new("TextButton", tabs)
	b.Size = UDim2.new(1, -8, 0, 50)
	b.Text = text
	b.Font = Enum.Font.GothamBold
	b.TextSize = 14
	b.BackgroundColor3 = Color3.fromRGB(30,30,40)
	b.TextColor3 = Color3.fromRGB(180,180,190)
	b.LayoutOrder = order
	Instance.new("UICorner", b).CornerRadius = UDim.new(0, 12)
	return b
end

local tabMisc = makeTab("‚öôÔ∏è MISC", 1)

-- Pages
local pages = Instance.new("Frame", frame)
pages.Size = UDim2.new(1, -185, 1, -95)
pages.Position = UDim2.new(0, 175, 0, 85)
pages.BackgroundTransparency = 1

local miscPage = Instance.new("ScrollingFrame", pages)
miscPage.Size = UDim2.fromScale(1,1)
miscPage.BackgroundTransparency = 1
miscPage.BorderSizePixel = 0
miscPage.ScrollBarThickness = 6
miscPage.CanvasSize = UDim2.new(0,0,0,0)
miscPage.AutomaticCanvasSize = Enum.AutomaticSize.Y
miscPage.Visible = true

-- Misc Page Content
local miscTopRow = Instance.new("Frame", miscPage)
miscTopRow.Size = UDim2.new(1, 0, 0, 180)
miscTopRow.BackgroundTransparency = 1

-- Character Card
local characterCard = Instance.new("Frame", miscTopRow)
characterCard.Size = UDim2.new(0.48, -5, 1, 0)
characterCard.BackgroundColor3 = Color3.fromRGB(28,28,38)
Instance.new("UICorner", characterCard).CornerRadius = UDim.new(0, 12)

local charStroke = Instance.new("UIStroke", characterCard)
charStroke.Color = Color3.fromRGB(255, 100, 100)
charStroke.Thickness = 2
charStroke.Transparency = 0.7

local charTitle = Instance.new("TextLabel", characterCard)
charTitle.Size = UDim2.new(1, -60, 0, 18)
charTitle.Position = UDim2.new(0, 55, 0, 15)
charTitle.BackgroundTransparency = 1
charTitle.Font = Enum.Font.GothamBold
charTitle.TextSize = 14
charTitle.TextColor3 = Color3.fromRGB(255,255,255)
charTitle.TextXAlignment = Enum.TextXAlignment.Left
charTitle.Text = "PERSONAGEM"

local godmodeBtn = Instance.new("TextButton", characterCard)
godmodeBtn.Size = UDim2.new(1, -24, 0, 38)
godmodeBtn.Position = UDim2.new(0, 12, 0, 60)
godmodeBtn.Text = "üõ°Ô∏è GODMODE"
godmodeBtn.Font = Enum.Font.GothamBold
godmodeBtn.TextSize = 13
godmodeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
godmodeBtn.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", godmodeBtn).CornerRadius = UDim.new(0, 8)

local godmodeEnabled = false
godmodeBtn.MouseButton1Click:Connect(function()
	godmodeEnabled = not godmodeEnabled
	godmodeBtn.Text = godmodeEnabled and "üõ°Ô∏è ON" or "üõ°Ô∏è GODMODE"
	godmodeBtn.BackgroundColor3 = godmodeEnabled and Color3.fromRGB(0, 160, 90) or Color3.fromRGB(60, 60, 70)
	if LocalPlayer.Character then
		local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
		if hum and godmodeEnabled then
			hum.MaxHealth = math.huge
			hum.Health = math.huge
		end
	end
end)

-- Utility Card
local utilityCard = Instance.new("Frame", miscTopRow)
utilityCard.Size = UDim2.new(0.48, -5, 1, 0)
utilityCard.Position = UDim2.new(0.52, 0, 0, 0)
utilityCard.BackgroundColor3 = Color3.fromRGB(28,28,38)
Instance.new("UICorner", utilityCard).CornerRadius = UDim.new(0, 12)

local utilStroke = Instance.new("UIStroke", utilityCard)
utilStroke.Color = Color3.fromRGB(100, 200, 255)
utilStroke.Thickness = 2
utilStroke.Transparency = 0.7

local utilTitle = Instance.new("TextLabel", utilityCard)
utilTitle.Size = UDim2.new(1, -60, 0, 18)
utilTitle.Position = UDim2.new(0, 55, 0, 15)
utilTitle.BackgroundTransparency = 1
utilTitle.Font = Enum.Font.GothamBold
utilTitle.TextSize = 14
utilTitle.TextColor3 = Color3.fromRGB(255,255,255)
utilTitle.TextXAlignment = Enum.TextXAlignment.Left
utilTitle.Text = "UTILIDADES"

local antiAfkBtn = Instance.new("TextButton", utilityCard)
antiAfkBtn.Size = UDim2.new(1, -24, 0, 38)
antiAfkBtn.Position = UDim2.new(0, 12, 0, 60)
antiAfkBtn.Text = "‚è∞ ANTI-AFK"
antiAfkBtn.Font = Enum.Font.GothamBold
antiAfkBtn.TextSize = 13
antiAfkBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
antiAfkBtn.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", antiAfkBtn).CornerRadius = UDim.new(0, 8)

local antiAfkEnabled = false
antiAfkBtn.MouseButton1Click:Connect(function()
	antiAfkEnabled = not antiAfkEnabled
	antiAfkBtn.Text = antiAfkEnabled and "‚è∞ ON" or "‚è∞ ANTI-AFK"
	antiAfkBtn.BackgroundColor3 = antiAfkEnabled and Color3.fromRGB(0, 160, 90) or Color3.fromRGB(60, 60, 70)
	if antiAfkEnabled then
		game:GetService("VirtualUser"):CaptureController()
		LocalPlayer.Idled:Connect(function()
			game:GetService("VirtualUser"):ClickButton2(Vector2.new())
		end)
	end
end)

-- Info Card
local infoCard = Instance.new("Frame", miscPage)
infoCard.Size = UDim2.new(1, 0, 0, 110)
infoCard.Position = UDim2.new(0, 0, 0, 190)
infoCard.BackgroundColor3 = Color3.fromRGB(28,28,38)
Instance.new("UICorner", infoCard).CornerRadius = UDim.new(0, 12)

local infoText = Instance.new("TextLabel", infoCard)
infoText.Size = UDim2.new(1, -24, 0, 60)
infoText.Position = UDim2.new(0, 12, 0, 45)
infoText.BackgroundTransparency = 1
infoText.Font = Enum.Font.Gotham
infoText.TextSize = 12
infoText.TextColor3 = Color3.fromRGB(180,180,200)
infoText.TextWrapped = true
infoText.TextXAlignment = Enum.TextXAlignment.Left
infoText.TextYAlignment = Enum.TextYAlignment.Top
infoText.Text = "‚Ä¢ M: Abrir/Fechar painel | ‚Ä¢ F: Toggle Fly | ‚Ä¢ P: Destravar mouse"

-- Functions
closeBtn.MouseButton1Click:Connect(function() 
	frame.Visible = false
	panelVisible = false
end)

UserInputService.InputBegan:Connect(function(input, processed)
	if processed then return end
	if input.KeyCode == Enum.KeyCode.M then 
		panelVisible = not panelVisible
		frame.Visible = panelVisible
		if panelVisible then
			UserInputService.MouseBehavior = Enum.MouseBehavior.Default
			UserInputService.MouseIconEnabled = true
		end
	elseif input.KeyCode == Enum.KeyCode.F then
		FlySystem:toggleFly()
	end
end)

FlySystem:init()
print("‚úÖ Admin Panel PRO carregado!")
print("üîë Pressione M para abrir o menu")
